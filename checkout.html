<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Оформление заказа - TravelShop</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/checkout.css">
</head>
<body>
    
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>TRAVELSHOP</h1>
                </div>
                <nav class="nav">
                    <ul class="nav-list">
                        <li><a href="index.html">Главная</a></li>
                        <li><a href="catalog.html">Все товары</a></li>
                        <li><a href="about.html">О нас</a></li>
                        <li><a href="contact.html">Поддержка</a></li>
                    </ul>
                </nav>
                <div class="header-actions">
                    <div class="search-container">
                        <input type="text" class="header-search-input" id="headerSearchInput" placeholder="Поиск товаров...">
                        <button class="icon-btn search-btn" id="searchBtn">
                            <img src="img/иконка поиска.png" alt="Поиск" class="header-icon">
                        </button>
                    </div>
                    <a href="login.html" class="icon-btn login-btn" title="Войти">
                        <img src="img/иконка1.png" alt="Войти" class="header-icon">
                    </a>
                    <button class="icon-btn cart-btn" id="cartBtn">
                        <img src="img/иконка корзины.png" alt="Корзина" class="header-icon">
                        <span class="cart-count">0</span>
                    </button>
                    <button class="menu-toggle" id="menuToggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    
    <section class="checkout-banner">
        <div class="container">
            <div class="checkout-banner-content">
                <h1>Оформление заказа</h1>
                <p>Завершите покупку и получите свой заказ в кратчайшие сроки</p>
            </div>
        </div>
    </section>

    
    <section class="checkout-container">
        <div class="container">
            <div id="checkoutContent">
                
            </div>
        </div>
    </section>

    
    <div class="cart-modal" id="cartModal">
        <div class="cart-modal-content">
            <div class="cart-modal-header">
                <h2>Корзина</h2>
                <button class="cart-close" id="cartClose">&times;</button>
            </div>
            <div class="cart-items" id="cartItems">
                <p class="cart-empty">Корзина пуста</p>
            </div>
            <div class="cart-total">
                <p>Итого: <span id="cartTotal">0 ₽</span></p>
                <button class="btn btn-black" id="checkoutBtn">Оформить заказ</button>
            </div>
        </div>
    </div>

    <script src="products.js"></script>
    <script src="cart.js"></script>
    <script src="script.js"></script>
    <script>
        let checkoutCart = [];
        
        try {
            const savedCart = localStorage.getItem('cart');
            if (savedCart) {
                checkoutCart = JSON.parse(savedCart);
            }
        } catch (e) {
            console.error('Error loading cart:', e);
        }

        function calculateTotals() {
            const subtotal = checkoutCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const delivery = subtotal > 5000 ? 0 : 500;
            const total = subtotal + delivery;
            
            return { subtotal, delivery, total };
        }
        function renderCheckout() {
            const content = document.getElementById('checkoutContent');
            
            if (checkoutCart.length === 0) {
                content.innerHTML = `
                    <div class="empty-cart-message">
                        <h2>Корзина пуста</h2>
                        <p>Добавьте товары в корзину, чтобы оформить заказ</p>
                        <a href="catalog.html" class="btn btn-black">Перейти в каталог</a>
                    </div>
                `;
                return;
            }

            const { subtotal, delivery, total } = calculateTotals();

            content.innerHTML = `
                <div class="checkout-grid">
                    
                    <div class="checkout-form">
                        <div class="checkout-section">
                            <h3>1. Контактная информация</h3>
                            <div class="form-row">
                                <div class="form-group-checkout">
                                    <label for="firstName">Имя *</label>
                                    <input type="text" id="firstName" required>
                                </div>
                                <div class="form-group-checkout">
                                    <label for="lastName">Фамилия *</label>
                                    <input type="text" id="lastName" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group-checkout">
                                    <label for="email">Email *</label>
                                    <input type="email" id="email" required>
                                </div>
                                <div class="form-group-checkout">
                                    <label for="phone">Телефон *</label>
                                    <input type="tel" id="phone" required>
                                </div>
                            </div>
                        </div>

                        <div class="checkout-section">
                            <h3>2. Адрес доставки</h3>
                            <div class="form-group-checkout">
                                <label for="city">Город *</label>
                                <input type="text" id="city" required>
                            </div>
                            <div class="form-group-checkout">
                                <label for="address">Улица, дом, квартира *</label>
                                <input type="text" id="address" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group-checkout">
                                    <label for="postalCode">Индекс</label>
                                    <input type="text" id="postalCode">
                                </div>
                                <div class="form-group-checkout">
                                    <label for="deliveryMethod">Способ доставки *</label>
                                    <select id="deliveryMethod" required>
                                        <option value="">Выберите способ</option>
                                        <option value="courier">Курьер</option>
                                        <option value="pickup">Самовывоз</option>
                                        <option value="post">Почта России</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group-checkout">
                                <label for="comment">Комментарий к заказу</label>
                                <textarea id="comment" rows="3"></textarea>
                            </div>
                        </div>

                        <div class="checkout-section">
                            <h3>3. Способ оплаты</h3>
                            <div class="payment-methods">
                                <label class="payment-option">
                                    <input type="radio" name="payment" value="card" checked>
                                    <span>Банковская карта</span>
                                </label>
                                <label class="payment-option">
                                    <input type="radio" name="payment" value="cash">
                                    <span>Наличными при получении</span>
                                </label>
                                <label class="payment-option">
                                    <input type="radio" name="payment" value="online">
                                    <span>Электронный кошелек</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    
                    <div class="order-summary">
                        <div class="order-summary-content">
                            <h3>Ваш заказ</h3>
                            <div class="order-items">
                                ${checkoutCart.map(item => `
                                    <div class="order-item">
                                        <div class="order-item-image">
                                            <img src="${item.image}" alt="${item.name}">
                                        </div>
                                        <div class="order-item-info">
                                            <div class="order-item-name">${item.name}</div>
                                            <div class="order-item-quantity">Количество: ${item.quantity}</div>
                                            <div class="order-item-price">${(item.price * item.quantity).toLocaleString('ru-RU')} ₽</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="order-totals">
                                <div class="order-total-row">
                                    <span>Товары (${checkoutCart.reduce((sum, item) => sum + item.quantity, 0)} шт.):</span>
                                    <span>${subtotal.toLocaleString('ru-RU')} ₽</span>
                                </div>
                                <div class="order-total-row">
                                    <span>Доставка:</span>
                                    <span>${delivery === 0 ? 'Бесплатно' : delivery.toLocaleString('ru-RU') + ' ₽'}</span>
                                </div>
                                ${delivery === 0 ? '<div class="order-total-row" style="color: green; font-size: 12px;"><span>Бесплатная доставка от 5000 ₽</span></div>' : ''}
                                <div class="order-total-row final">
                                    <span>Итого:</span>
                                    <span>${total.toLocaleString('ru-RU')} ₽</span>
                                </div>
                            </div>
                            <button class="btn btn-black place-order-btn" id="placeOrderBtn">Оформить заказ</button>
                        </div>
                    </div>
                </div>
            `;

            document.querySelectorAll('.payment-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    option.querySelector('input[type="radio"]').checked = true;
                });
            });

            document.getElementById('placeOrderBtn').addEventListener('click', placeOrder);
        }

        function placeOrder() {
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const city = document.getElementById('city').value;
            const address = document.getElementById('address').value;
            const deliveryMethod = document.getElementById('deliveryMethod').value;
            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;

            if (!firstName || !lastName || !email || !phone || !city || !address || !deliveryMethod) {
                alert('Пожалуйста, заполните все обязательные поля');
                return;
            }

            const { total } = calculateTotals();

            alert(`Заказ успешно оформлен!\n\nПолучатель: ${firstName} ${lastName}\nEmail: ${email}\nТелефон: ${phone}\nАдрес: ${city}, ${address}\n\nСумма заказа: ${total.toLocaleString('ru-RU')} ₽\n\nМы свяжемся с вами в ближайшее время для подтверждения заказа.`);

            localStorage.removeItem('cart');
            cart = [];
            cartCount = 0;
            updateCartCount();

            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        }
        document.addEventListener('DOMContentLoaded', () => {
            renderCheckout();
        });
    </script>
</body>
</html>

